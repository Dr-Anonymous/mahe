---
---

<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Intercom</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="Intercom">
	<meta name="description" content="intercom,connect,webRTC">
	<meta name="author" content="Orthosam.com">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
</head>

<body>
<div class="container">
<div class="row vh-100 position-relative">
		<div class="position-absolute top-0 start-0">
			<Video class="w-100" id="remoteVideo" controls>
		</div>
		
		<div class="position-absolute top-0 start-0">
			<Video class="w-25" id="localVideo" controls muted>
		</div>
		
		<div class="position-absolute bottom-0 start-0 text-end">
			<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#chats">Open Chat</button>
		</div>
</div>
</div>

<div class="modal fade" id="chats" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Chats</h3>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		  </div>
		  <div class="modal-body">
			<div class="text-info" id="chatlog" style="height:350px; overflow:auto;"></div>
		  </div>
		  <div class="modal-footer">
			<form class="form-inline" onSubmit="return sendMessage()" action="">
			<input type="text" id="messageTextBox" placeholder="Type message here">
			<button class="btn btn-secondary" type="submit" id="sendMessageBtn">Send message</button>
			</form>
			<input class="btn btn-secondary" type="file" id="fileBtn">
		  </div>
		</div>
	</div>
</div>


<div class="modal fade" id="showLocalOffer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Your are the first one here...</h3>
		  </div>
		  <div class="modal-body">
			Initiate an intercom call.
		  <br/>
			Give appropriate camera and audio permissions in the next page.
		  <textarea class="input-large d-none" id="localOffer" name="localOffer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer">
			<button class="btn btn-primary" id="offerSentBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#getRemoteAnswer">Initiate.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="showLocalAnswer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Joining a call .....<!--Send your local answer to someone else--></h3>
		  </div>
		  <div class="modal-body">
			Your are joining the intercom call initiated by others......
			<!--Here's your "answer" -- it tells someone else how to connect to you.  Send the whole thing to them, for example in an instant message or e-mail.-->
		  <br/>
		  <textarea class="input-large d-none" id="localAnswer" name="localAnswer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn btn-primary" id="answerSentBtn" data-bs-dismiss="modal">Okay, I sent it.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="getRemoteOffer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Joining a call...</h3>
		  </div>
		  <div class="modal-body">
			Your are joining the intercom call initiated by others......
		  <br/>
		  <textarea class="input-large d-none" id="remoteOffer" name="remoteOffer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer">
			<button class="btn btn-primary" id="offerRecdBtn" data-bs-dismiss="modal">Okay, Join.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="getRemoteAnswer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Your are the first one here</h3>
		  </div>
		  <div class="modal-body">
			Initiating intercom. Waiting for others....<br/>
			Remember intercom works best on local networks like a WIFI.
		  <br/>
		  <textarea class="input-large d-none" id="remoteAnswer" name="remoteAnswer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn btn-primary" id="answerRecdBtn" data-bs-dismiss="modal" aria-hidden="true">Okay, I pasted it.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="waitForConnection" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Waiting for connection</h3>
		  </div>
		  <div class="modal-body">
			This dialog will disappear when a connection is made.
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="createOrJoin" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Creating or joining a room....</h3>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn" id="joinBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#getRemoteOffer">Join</button>
			<button class="btn btn-primary" id="createBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#showLocalOffer">Create</button>
		  </div>
		</div>
	</div>
</div>

<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
	
	// Firebase configuration
	const firebaseConfig = {
	apiKey: "AIzaSyBclMUk5tqdNWgdIOB8MRnq9m31t0QFlDQ",
	authDomain: "cam-control-a9d76.firebaseapp.com",
	databaseURL: "https://cam-control-a9d76-default-rtdb.firebaseio.com",
	projectId: "cam-control-a9d76",
	storageBucket: "cam-control-a9d76.appspot.com",
	messagingSenderId: "835440701577",
	appId: "1:835440701577:web:3ba52373edd9b2db3b9658"
	};

	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
	
	var firstTime = true;
	const db = getDatabase();
	const callerdb = ref(db, '1/');
	const receiverdb = ref(db, '2/');
	onValue(callerdb, (snapshot) => {
	  const data = snapshot.val();
	  //console.log(data);
	  window.data = data;
	  
	  if (data == null && firstTime) { $('#createBtn').click(); firstTime = false;}
	  else { if (firstTime) $('#joinBtn').click(); }
	});
	
	onValue(receiverdb, (snapshot) => {
	  const hisoffer = snapshot.val();
	  //console.log(hisoffer);
	  window.hisoffer = hisoffer;
	  if (!firstTime && hisoffer != null) { $('#answerRecdBtn').click();}
	});
	window.set = set;
	window.callerdb = callerdb;
	window.receiverdb = receiverdb;
	
	window.onunload = function(){
	set(ref(db), null);
	};
</script>

<script src="./serverless-webrtc.js"></script>
<script src="./file-transfer.js"></script>

</body>
</html>
