---
---

<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Intercom</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="Intercom">
	<meta name="description" content="intercom, connect, webRTC">
	<meta name="author" content="Orthosam.com">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
</head>

<body>
<div class="container">
<div class="row position-relative">
		<div class="col">
			<Video class="mw-100 h-auto" id="remoteVideo" controls>
		</div>
		
		<div class="position-absolute top-0 start-0">
			<Video class="w-25" id="localVideo" controls muted>
		</div>
		
		<div class="row position-absolute bottom-0 start-0">
		
		<div class="col text-center">
			<!-- empty space for play button -->
		</div>
		<div class="col text-center">
			<button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#chats">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
				  <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
				</svg>
			</button>
		</div>
		<div class="col text-center">
			<button id="record" class="btn btn-secondary" state="start">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-record-circle" viewBox="0 0 16 16">
				  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
				  <path d="M11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
				</svg>
			</button>
		</div>
		<div class="col text-center">
			<button id="play" class="btn btn-secondary" disabled>
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
				  <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
				</svg>
			</button>
		</div>
		<div class="col text-center">
			<button id="download" class="btn btn-secondary" disabled>
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
				  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
				  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
				</svg>
			</button>
		</div>
		
		</div>
</div>
</div>

<div class="modal fade" id="chats" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Chats</h3>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		  </div>
		  <div class="modal-body">
			<div class="text-info" id="chatlog" style="height:350px; overflow:auto;"></div>
		  </div>
		  <div class="modal-footer">
			<form class="form-inline" onSubmit="return sendMessage()" action="">
			<input type="text" id="messageTextBox" placeholder="Type message here">
			<button class="btn btn-secondary" type="submit" id="sendMessageBtn">Send message</button>
			</form>
			<input class="btn btn-secondary" type="file" id="fileBtn">
		  </div>
		</div>
	</div>
</div>


<div class="modal fade" id="showLocalOffer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Your are the only one here...</h3>
		  </div>
		  <div class="modal-body">
			Initiate an intercom call.
		  <br/>
			Give appropriate camera and audio permissions in the next page.
			<br/>
		  <textarea class="input-large d-none" id="localOffer" name="localOffer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer">
			<button class="btn btn-primary" id="offerSentBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#getRemoteAnswer">Initiate.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="showLocalAnswer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Joining a call .....<!--Send your local answer to someone else--></h3>
		  </div>
		  <div class="modal-body">
			Your are joining the intercom call initiated by others......
			
			<!--Here's your "answer" -- it tells someone else how to connect to you.  Send the whole thing to them, for example in an instant message or e-mail.-->
		  <br/>
		  <textarea class="input-large d-none" id="localAnswer" name="localAnswer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn btn-primary" id="answerSentBtn" data-bs-dismiss="modal">Okay, I sent it.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="getRemoteOffer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Joining a call...</h3>
		  </div>
		  <div class="modal-body">
			Your are joining the intercom call initiated by others......
		  <br/>
			Give appropriate camera and audio permissions in the next page.
		  <br/>
		  <textarea class="input-large d-none" id="remoteOffer" name="remoteOffer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer">
			<button class="btn btn-primary" id="offerRecdBtn" data-bs-dismiss="modal">Okay, Join.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="getRemoteAnswer" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Your are the only one here</h3>
		  </div>
		  <div class="modal-body">
			Initiating intercom. Waiting for others....<br/>
			Remember intercom works best on local networks like a WIFI.
		  <br/>
		  <textarea class="input-large d-none" id="remoteAnswer" name="remoteAnswer" rows="10" cols="100"></textarea>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn btn-primary" id="answerRecdBtn" data-bs-dismiss="modal" aria-hidden="true">Okay, I pasted it.</button>
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="waitForConnection" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Waiting for connection</h3>
		  </div>
		  <div class="modal-body">
			This dialog will disappear when a connection is made.
		  </div>
		</div>
	</div>
</div>

<div class="modal fade" id="createOrJoin" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-fullscreen">
		<div class="modal-content">
		  <div class="modal-header">
			<h3 id="myModalLabel">Creating or joining a room....</h3>
		  </div>
		  <div class="modal-footer d-none">
			<button class="btn" id="joinBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#getRemoteOffer">Join</button>
			<button class="btn btn-primary" id="createBtn" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#showLocalOffer">Create</button>
		  </div>
		</div>
	</div>
</div>
<div id="options" class="d-none">
<br/>
<div>
<span>Share screen: </span>
<button class="btn btn-secondary" id="screenShare" share="no" onclick="if ($(this).attr('share')== 'no') {$(this).addClass('btn-primary').removeClass('btn-secondary').attr('share', 'yes');} else {$(this).addClass('btn-secondary').removeClass('btn-primary').attr('share', 'no');}">
	<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
	  <path d="M3 3.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Zm1.5 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Zm1 .5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1Z"/>
	  <path d="M.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h15a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5H.5ZM1 5V2h14v3H1Zm0 1h14v8H1V6Z"/>
	</svg>
</button>
</div>
<br/>
<div>
	<span>Codec preferences: </span>
	<select id="codecPreferences" disabled>
		<option selected value="">Default</option>
	</select>
</div>
<br/>
<br/>
<br/>
<div class="select">
	<label for="audioSource">Audio input source: </label><select id="audioSource"></select>
</div>

<div class="select">
	<label for="audioOutput">Audio output destination: </label><select id="audioOutput"></select>
</div>

<div class="select">
	<label for="videoSource">Video source: </label><select id="videoSource"></select>
</div>
</div>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
	
	// Firebase configuration
	const firebaseConfig = {
	apiKey: "AIzaSyBclMUk5tqdNWgdIOB8MRnq9m31t0QFlDQ",
	authDomain: "cam-control-a9d76.firebaseapp.com",
	databaseURL: "https://cam-control-a9d76-default-rtdb.firebaseio.com",
	projectId: "cam-control-a9d76",
	storageBucket: "cam-control-a9d76.appspot.com",
	messagingSenderId: "835440701577",
	appId: "1:835440701577:web:3ba52373edd9b2db3b9658"
	};
	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
	window.set = set;
	window.ref = ref;
	
	var one = false,
		two = false;
	window.db = getDatabase();
	
	onValue(ref(db), (snapshot) => {
	  const data = snapshot.val();
	  //console.log(data);
	  if (data == null) {
			pc1.restartIce();
			one = true;
			two = false;
			$("#showLocalOffer .modal-body").append($("#options").html()); $("#options").remove(); $('#createBtn').click();
	  } else {
		if (data.length > 1) { if (two) return; window.remoteAnswer = data[1]; $('#answerRecdBtn').click(); }
		else { if (one) return; two = true; window.remoteOffer = data[0]; $("#getRemoteOffer .modal-body").append($("#options").html()); $("#options").remove(); $('#joinBtn').click();}
	  }
	});
	window.onunload = function(){
	set(ref(db), null);
	};
</script>

<script src="./sources.js"></script>
<script src="./webrtc.js"></script>
<script src="./record.js"></script>
<script src="./chat.js"></script>
<script src="./file-transfer.js"></script>

</body>
</html>
